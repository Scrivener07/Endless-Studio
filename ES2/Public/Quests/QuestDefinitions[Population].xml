<?xml version="1.0" encoding="utf-8" ?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:noNamespaceSchemaLocation="../Schemas/QuestDefinition.xsd">


    
    <!-- ####################################### -->
    <!--               POPULATION QUEST            -->
    <!-- ####################################### -->

    <!--           POPULATION QUEST 02       -->
    <!--            Those darn Kids        -->

   <QuestDefinition Name="PopulationQuest02" Category="PopulationQuest" SubCategory="Population" MinimumTurn="40" TriggeringProbability="1">
       
        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>


        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <!--Select a first Colonized System (state colony) with some Sophons inside-->
            <Var VarName="$SophonsSystems01">
                <Any>
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">//ClassPopulation,ClassPopulationStarSystem,ClassPopulationStarSystemAffinitySophonsCount</PathPrerequisite>
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">ClassColonizedStarSystem,ColonizedStarSystemStateOutpost</PathPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$SophonsSystem01Location">
                <From Source="$SophonsSystems01.$StarSystem"/>
            </Var>
            <!--Find its Hangar-->
            <Var VarName="$HangarOfSophonsSystem01">
                <From Source="$SophonsSystems01.$Hangar"></From>
            </Var>
            <!--Select another System where there are some Sophons inside-->
            <Var VarName="$SophonsSystems02">
                <Any>
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">//ClassPopulation,ClassPopulationStarSystem,ClassPopulationStarSystemAffinitySophonsCount</PathPrerequisite>
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">ClassColonizedStarSystem,ColonizedStarSystemStateOutpost</PathPrerequisite>
                            <IsNot EntityVarName="$SophonsSystems01"/>
                        </Where>

                    </From>
                </Any>
            </Var>
            <Var VarName="$SophonsSystem02Location">
                <From Source="$SophonsSystems02.$StarSystem"/>
            </Var>
            <!--Find its Hangar-->
            <Var VarName="$HangarOfSophonsSystem02">
                <From Source="$SophonsSystems02.$Hangar"></From>
            </Var>

            <!--How many ships we need-->
            <Var VarName="$MinimumAmount01" IntValue="2"/>


            <!--Define the Timer-->
            <Var VarName="$Duration" IntValue="10"/>
            <!--Define the type of Buildings we need-->
            <Var VarName="$ScienceBuildings" StringValue="SubCategoryScience"/>
            <!--Define the type of Buildings we DON'T want-->
            <Var VarName="$OtherBuildings" StringValue="!SubCategoryScience"/>

            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinitySophonsCount', PopulationCount, true) lt 1"/>

            <LocalizationVar LocalizationKey="$SystemName01" Source="$SophonsSystem01Location"/>
            <LocalizationVar LocalizationKey="$SystemName02" Source="$SophonsSystem02Location"/>

        </Vars>

        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite" Inverted="true">EmpireTypeMajor,AffinityVampirilis</PathPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Count(Context, @'ClassEmpire/ColonizedStarSystemStateColony/ClassPopulation,ClassPopulationStarSystemAffinitySophonsCount') ge 2</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <!--Let's choose-->
            <Step Name="Step1">
                <!--============ STEP 1 - Choose ============-->

                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                </Choice>

                <!--============ Build a Science Building ============-->
                <ObjectiveSet ObjectiveComposition="All">
                    <Objective Name="C1Step1_Objective1" StartValue="0" EndValue="10">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="10" MaxAutoResolutionTurn="12" AutoResolutionProbability="0.5" />
                        <Parallel CompletionPolicy="First">
                            <!--In prio we want it checks the success before the failure: the corresponding step is the first-->
                            <Sequence>
                                <!--wait 10 turn + build Science Building-->
                                <Parallel CompletionPolicy="All">
                                    <Sequence>
                                        <Decorator_ConstructionCompleted Initiator="Empire">
                                            <Input_ConstructionSubCategory VarName="$ScienceBuildings"/>
                                            <Input_ValidType>Building</Input_ValidType>
                                        </Decorator_ConstructionCompleted>
                                    </Sequence>
                                    <Sequence>
                                        <Loop Count="10">
                                            <Decorator_BeginTurn ProgressionIncrement="1"/>
                                        </Loop>
                                    </Sequence>
                                </Parallel>
                            </Sequence>
                            <!--If the player builds something else he/she fails-->
                            <Sequence>
                                <Decorator_ConstructionCompleted Initiator="Empire">
                                    <Input_ConstructionSubCategory VarName="$OtherBuildings"/>
                                    <Input_ValidType>Building</Input_ValidType>
                                    <Input_ValidType>Ship</Input_ValidType>
                                </Decorator_ConstructionCompleted>
                                <Action_Fail/>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            <Sequence>
                                <!--If more than 10 turns = fail-->
                                <Loop Count="10">
                                    <Decorator_BeginTurn/>
                                </Loop>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                    <Reward Droplist="DroplistPopulation03" Picks="1"/>
                </ObjectiveSet>

                <!--============ STEP 2 - Call the Police ============-->
                <ObjectiveSet ObjectiveComposition="All">
                    <Objective Name="C2Step1_Objective1" StartValue="0" EndValue="10">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="10" MaxAutoResolutionTurn="10" AutoResolutionProbability="0.5" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Parallel CompletionPolicy="All">
                                    <Sequence>
                                        <!--Fill 2 Hangars of Sophons System with 2 Ships each-->
                                        <Decorator_BeginTurn>
                                            <Condition_HasGarrisonComposition>
                                                <Input_Garrisons VarName="$HangarOfSophonsSystem01"/>
                                                <Input_MinimumAmount VarName="$MinimumAmount01"/>
                                            </Condition_HasGarrisonComposition>
                                        </Decorator_BeginTurn>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_BeginTurn>
                                            <Condition_HasGarrisonComposition>
                                                <Input_Garrisons VarName="$HangarOfSophonsSystem02"/>
                                                <Input_MinimumAmount VarName="$MinimumAmount01"/>
                                            </Condition_HasGarrisonComposition>
                                        </Decorator_BeginTurn>
                                    </Sequence>
                                </Parallel>
                            </Sequence>
                            <Sequence>
                                <Loop Count="10">
                                    <Decorator_BeginTurn ProgressionIncrement="1"/>
                                </Loop>
                                <Action_Fail/>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                    <Reward Droplist="DroplistPopulation02" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 03       -->
    <!--            10/10 With Spice         -->

   <QuestDefinition Name="PopulationQuest03" Category="PopulationQuest" SubCategory="Population" MinimumTurn="50" TriggeringProbability="0.2">
    
      <!--============ TAGS ============-->
      
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire">
                </From>
            </Var>
            <!--All Water Planet Types -->
            <Var VarName="$PlanetType01" StringValue="PlanetTypeSwamp"/>
            <Var VarName="$PlanetType02" StringValue="PlanetTypeAtoll"/>
            <Var VarName="$PlanetType03" StringValue="PlanetTypeOcean"/>
            <Var VarName="$PlanetType04" StringValue="PlanetTypeIce"/>

            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinityVenetiansCount', PopulationCount, true) lt 1"/>


        </Vars>

        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
         
            <PathPrerequisite Flags="Prerequisite" Inverted="true">EmpireTypeMajor,AffinityVampirilis</PathPrerequisite>              
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinityVenetiansCount', PopulationCount, true) ge 10</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>

            <!--============ Build a Science Building ============-->
            <Step Name="Step01">
                <ObjectiveSet>
                    <Objective Name="Objective01" StartValue="0" EndValue="2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Loop Count="2">
                                    <Sequence>
                                        <!--Colonize twine a flooded planet among all water Planet Type-->
                                        <Parallel CompletionPolicy="Any">
                                            <Sequence>
                                                <!--Colonize from a Colonized System OR outpost a Flooded Planet-->
                                                <Decorator_ColonizedPlanet ProgressionIncrement="1">
                                                    <Input_PlanetType VarName="$PlanetType01"/>
                                                </Decorator_ColonizedPlanet>
                                            </Sequence>
                                            <Sequence>
                                                <Decorator_ColonizedPlanet ProgressionIncrement="1">
                                                    <Input_PlanetType VarName="$PlanetType02"/>
                                                </Decorator_ColonizedPlanet>
                                            </Sequence>
                                            <Sequence>
                                                <Decorator_ColonizedPlanet ProgressionIncrement="1">
                                                    <Input_PlanetType VarName="$PlanetType03"/>
                                                </Decorator_ColonizedPlanet>
                                            </Sequence>
                                            <Sequence>
                                                <Decorator_ColonizedPlanet ProgressionIncrement="1">
                                                    <Input_PlanetType VarName="$PlanetType04"/>
                                                </Decorator_ColonizedPlanet>
                                            </Sequence>
                                        </Parallel>
                                    </Sequence>
                                </Loop>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistLuxuriesEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 05       -->
    <!--          And Out of the Smoke       -->


   <QuestDefinition Name="PopulationQuest05" Category="PopulationQuest" SubCategory="Population" MinimumTurn="10" TriggeringProbability="1">
     
           
            <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$CraversSystem">
                <Any>
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ClassColonizedStarSystem/ClassPopulationStarSystemAffinityCraversCount</PathPrerequisite>
                            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassColonizedStarSystem/ClassPopulationStarSystemAffinityCraversCount', PopulationCount, true) ge 6</InterpreterPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$CraverSystemLocation">
                <From Source="$CraversSystem.$StarSystem"/>
            </Var>
            <Var VarName="$MinimumAttack" IntValue="64"/>
            <Var VarName="$FakeMinimumAttack" IntValue="65"/>
            <Var VarName="$Ships"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01" IntValue="1"/>
            <Var VarName="$RequiredTag" StringValue="ShipForBattle"/>
            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinityCraversCount', PopulationCount, true) lt 1"/>
            <LocalizationVar LocalizationKey="$CraverSystem"      Source="$CraverSystemLocation"/>
            <LocalizationVar LocalizationKey="$FakeMinimumAttackName" Source="$FakeMinimumAttack"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite" Inverted="true">EmpireTypeMajor,AffinityVampirilis</PathPrerequisite>
            <!--Launch if Cravers exist in the Empire-->            
            <PathPrerequisite Flags="Prerequisite" Inverted="false">EmpireTypeMajor/ClassPopulationEmpireAffinityCravers,!ClassPopulationCustomAffinity</PathPrerequisite>
            <!--There are also 2 Cravers-->
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulation,ClassPopulationEmpireAffinityCravers,!ClassPopulationCustomAffinity', PopulationCount, true) ge 10</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>
                    <StartActions>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$CraverSystemLocation"/>
                            <Input_Empires VarName="$CurrentEmpire"/>                            
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step01_Objective1" StartValue="0" EndValue="2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="20" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Loop Count="2">                                   
                                    <Decorator_ShipConstructed Initiator="Empire" ProgressionIncrement="1">
                                        <Condition_ShipStats>                                            
                                            <Input_ShipList VarName="$Ships"/>
                                            <Input_MinimumAmount VarName="$Amount01"/>
                                            <Input_MinimumOffensiveMilitaryPower VarName="$MinimumAttack"/>
                                        </Condition_ShipStats>
                                        <Input_Node VarName="$CraverSystemLocation"/>
                                        <Input_RequiredTag VarName="$RequiredTag"/>
                                        <Output_Ship VarName="$Ships"/>
                                    </Decorator_ShipConstructed>
                                </Loop>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistStrategicsEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>


    <!--           POPULATION QUEST 06       -->
    <!--               Bug Fixing            -->

   <QuestDefinition Name="PopulationQuest06" Category="PopulationQuest" SubCategory="Population" MinimumTurn="15" TriggeringProbability="1">

        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
          
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$CraversSystem">
                <Any>
                  <From Source="$CurrentEmpire.$ColonizedStarSystems">
                      <Where>            
                         <!--<InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassColonizedStarSystem', Population) lt 8</InterpreterPrerequisite>-->                        
                          <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassColonizedStarSystem/ClassPopulationStarSystemAffinityCravers,!ClassPopulationCustomAffinity', PopulationCount, true) eq 2</InterpreterPrerequisite>
                          <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @ClassColonizedStarSystem, MaximumPopulation) - Property(Context, @ClassColonizedStarSystem, Population) gt 0</InterpreterPrerequisite>
                    </Where>
                  </From>
                </Any>
            </Var>
            <Var VarName="$CraversSystemLocation">
                <From Source="$CraversSystem.$StarSystem"/>
            </Var>
               
            <Var VarName="$Cravers" StringValue="AffinityCravers"/>
            <Var VarName="$Amount01" IntValue="3"/>
            <Var VarName="$Amount02" IntValue="4"/>
            <Var VarName="$Duration" IntValue="16"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Timer"/>
                        
            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinityCraversCount', PopulationCount, true) lt 1"/>
            <LocalizationVar LocalizationKey="$SystemName" Source="$CraversSystemLocation"/>
          </Vars>

        <!--============ PREREQUISITES ============-->
        
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite" Inverted="true">EmpireTypeMajor,AffinityVampirilis</PathPrerequisite>
            <!--Launch if Cravers exist in the Empire-->        
            <PathPrerequisite Flags="Prerequisite" Inverted="false">ClassEmpire/ClassColonizedStarSystem/ClassRecipeImprovement</PathPrerequisite>
            <!--There are also 2 Cravers-->
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityCravers,!ClassPopulationCustomAffinity', PopulationCount, true) ge 2</InterpreterPrerequisite>
            
        </Prerequisites>
        
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>
                    <StartActions>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$CraversSystemLocation"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_StartTimer>
                            <Input_Duration VarName="$Duration"/>
                            <Output_Timer VarName="$Timer"/>
                        </Action_StartTimer>
                    </StartActions>
                    <Objective Name="Step01_Objective1" StartValue="0" EndValue="2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="9" MaxAutoResolutionTurn="10" AutoResolutionProbability="0.5" />
                        <Parallel CompletionPolicy="First">                           
                            <Sequence>
                                <!--Make appear 2 more Cravers in a System where Cravers are-->
                                <Decorator_BeginTurn ProgressionIncrement="1">
                                    <Condition_HasPopulationAmount>
                                        <Input_Empire VarName="$CurrentEmpire"/>
                                        <Input_MinimumAmount VarName="$Amount01"/>
                                        <Input_Location VarName="$CraversSystemLocation"/>
                                        <Input_PopulationAffinity VarName="$Cravers"/>
                                    </Condition_HasPopulationAmount>
                                </Decorator_BeginTurn>
                                <Decorator_BeginTurn ProgressionIncrement="1">
                                    <Condition_HasPopulationAmount>
                                        <Input_Empire VarName="$CurrentEmpire"/>
                                        <Input_MinimumAmount VarName="$Amount02"/>
                                        <Input_Location VarName="$CraversSystemLocation"/>
                                        <Input_PopulationAffinity VarName="$Cravers"/>
                                    </Condition_HasPopulationAmount>
                                </Decorator_BeginTurn>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_TimerEnded>
                                        <Input_Timer VarName="$Timer"/>
                                    </Condition_TimerEnded>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            <Sequence>                               
                                <Decorator_InvadeSystem Initiator="OtherEmpires">
                                    <Input_System VarName="$CraversSystemLocation"/>
                                    <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                </Decorator_InvadeSystem>                                
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                     </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistPrestige" Picks="1"/>
            </Step>
         </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 07       -->
    <!--            Lifting The Lamp         -->


    <QuestDefinition Name="PopulationQuest07" Category="PopulationQuest" SubCategory="Population" MinimumTurn="20" TriggeringProbability="1">

        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <InterpretedVar VarName="$TargetedNumberOfFaction" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', PopulationTypeCount) + 1</Expression>
            </InterpretedVar>
            
        </Vars>
        

        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
           <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @ClassEmpire/ClassResearch, TechnologyQuadrantGlobalProgress) ge 2</InterpreterPrerequisite>
           <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire', PopulationTypeCount) ge 3</InterpreterPrerequisite>            
           <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire', ColonizedStarSystemStateColonyCount) ge 3</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>
                    <Objective Name="Step01_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Sequence>
                            <!--Check if the Player obtains +1 Faction (compare to the initial one)-->
                            <Decorator_BeginTurn>                               
                                <Condition_HasPopulationDiversity>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$TargetedNumberOfFaction"/>                                    
                                </Condition_HasPopulationDiversity>                                
                            </Decorator_BeginTurn>
                        </Sequence>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistPrestigeEra2" Picks="1"/>               
            </Step>
        </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 10       -->
    <!--                   ?                 -->


   <QuestDefinition Name="PopulationQuest10" Category="PopulationQuest" SubCategory="Population" TriggeringProbability="0.6">
    
     
      

        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$MyColonizedStarSystem">
                <Any>
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">ClassColonizedStarSystem, HomeSystem</PathPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var>
            
            <Var VarName="$MyStarSystemLocation">
                <From Source="$MyColonizedStarSystem.$StarSystem"/>  
            </Var>
            
            <Var VarName="$MyPlanet">
                <Any>   
                     <From Source="$MyStarSystemLocation.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$MyPlanetGUID"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Curiosity01" StringValue="Curiosity_Quest_Population01"/>
            
            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpire,ClassPopulationEmpireAffinityVampirilisCount', PopulationCount, true) lt 1"/>
            
            <InterpretedVar VarName="$Amount01" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire/ClassResearch', TechnologyQuadrantGlobalProgress) * 150</Expression>
            </InterpretedVar>

            <LocalizationVar Source="$Amount01" LocalizationKey="$Amount01Name"/>
            <LocalizationVar Source="$MyPlanet" LocalizationKey="$MyPlanetName"/>

        </Vars>


        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityVampirilisCount', PopulationCount, true) ge 10 </InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @ClassEmpire/ClassResearch, TechnologyQuadrantGlobalProgress) ge 2</InterpreterPrerequisite> 
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>
                    <StartActions>                        
                        <Action_SpawnCuriosity>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Input_Planets VarName="$MyPlanet"/>
                            <Input_CuriosityDefinition VarName="$Curiosity01"/>
                            <Output_CuriosityGUIDs VarName="$MyPlanetGUID"/>
                        </Action_SpawnCuriosity>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$MyPlanet"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step01_Objective01">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_CuriosityDiscovered Initiator="Empire">
                                    <Input_CuriosityGUIDs VarName="$MyPlanetGUID"/>
                                </Decorator_CuriosityDiscovered>                         
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistPrestigeEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 11       -->
    <!--                   ?                 -->


   <QuestDefinition Name="PopulationQuest11" Category="PopulationQuest" SubCategory="Population" MinimumTurn="30" TriggeringProbability="1">  
       
        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$MyColonizedStarSystems">              
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ColonizedStarSystemStateColony/ClassPopulationStarSystemAffinityTerransCount</PathPrerequisite>                           
                            <!--<PathPrerequisite Flags="Prerequisite" Inverted="true">ClassColonizedStarSystem,ColonizedStarSystemStateOutpost</PathPrerequisite>-->
                        </Where>
                    </From>                
            </Var>
            <Var VarName="$ColonizedStarSystem01">
                <Any>
                    <From Source="$MyColonizedStarSystems"/>
                </Any>
            </Var>
            <Var VarName="$StarSystem01">
                <From Source="$ColonizedStarSystem01.$StarSystem"/>
            </Var>
            <Var VarName="$ColonizedStarSystem02">
                <Any>
                    <From Source="$MyColonizedStarSystems">
                        <Where>
                            <IsNot EntityVarName="$ColonizedStarSystem01"/>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$StarSystem02">
                <From Source="$ColonizedStarSystem02.$StarSystem"/>
            </Var>
            <Var VarName="$ColonizedStarSystem03">
                <Any>
                    <From Source="$MyColonizedStarSystems">
                        <Where>
                            <IsNot EntityVarName="$ColonizedStarSystem01"/>
                            <IsNot EntityVarName="$ColonizedStarSystem02"/>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$StarSystem03">
                <From Source="$ColonizedStarSystem03.$StarSystem"/>
            </Var>

            <Var VarName="$Expression04" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityTerransCount', PopulationCount, true) lt 1"/>
            
            <Var VarName="$Expression01" StringValue="Property(ColonizedStarSystem01, @'ClassColonizedStarSystem/ClassHero', Level, true) ge 5"/>
            <Var VarName="$Expression02" StringValue="Property(ColonizedStarSystem02, @'ClassColonizedStarSystem/ClassHero', Level, true) ge 5"/>
            <Var VarName="$Expression03" StringValue="Property(ColonizedStarSystem03, @'ClassColonizedStarSystem/ClassHero', Level, true) ge 5"/>

            <Var VarName="$Expression05" StringValue="Property(ColonizedStarSystem01, @'ClassColonizedStarSystem', Happiness, true) ge 60"/>
            <Var VarName="$Expression06" StringValue="Property(ColonizedStarSystem02, @'ClassColonizedStarSystem', Happiness, true) ge 60"/>
            <Var VarName="$Expression07" StringValue="Property(ColonizedStarSystem03, @'ClassColonizedStarSystem', Happiness, true) ge 60"/>

            <Var VarName="$Amount01" IntValue="5"/>
            <Var VarName="$Amount02" IntValue="60"/>

            <Var VarName="$Marker01"/>
            <Var VarName="$Marker02"/>
            <Var VarName="$Marker03"/>
            
            <LocalizationVar LocalizationKey="$Amount01Name" Source="$Amount01"/>
            <LocalizationVar LocalizationKey="$Amount02Name" Source="$Amount02"/>
            <LocalizationVar LocalizationKey="$StarSystem01Name" Source="$StarSystem01"/>
            <LocalizationVar LocalizationKey="$StarSystem02Name" Source="$StarSystem02"/>
            <LocalizationVar LocalizationKey="$StarSystem03Name" Source="$StarSystem03"/>
            
        </Vars>


        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">               
            <InterpreterPrerequisite Flags="Prerequisite">Count(Context, @'ClassEmpire/ColonizedStarSystemStateColony/ClassPopulation,ClassPopulationStarSystemAffinityTerransCount') ge 3</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassEducation', HeroCount) ge 2</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire', Happiness) ge 50</InterpreterPrerequisite>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Sheredyn" QuestState="InProgress"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Sheredyn" QuestState="Completed"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Sheredyn" QuestState="Failed"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Mezari" QuestState="InProgress"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Mezari" QuestState="Completed"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="UE_Quest-Chapter4.1-Mezari" QuestState="Failed"/>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>                   
                </Choice>
           
                <ObjectiveSet>
                    <StartActions>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem01"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem02"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker02"/>
                        </Action_AddQuestMarkers>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem03"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker03"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">                
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />                    
                        <Parallel CompletionPolicy="First">
                            <Sequence>                               
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>                                  
                                        <Input_Context VarName="$CurrentEmpire"/>                                   
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression02"/>
                                    </Condition_CheckInterpreter>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression03"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                    <Action_RemoveQuestMarkers>
                                        <Input_Markers VarName="$Marker01"/>
                                    </Action_RemoveQuestMarkers>
                                    <Action_RemoveQuestMarkers>
                                        <Input_Markers VarName="$Marker02"/>
                                    </Action_RemoveQuestMarkers>
                                    <Action_RemoveQuestMarkers>
                                        <Input_Markers VarName="$Marker03"/>
                                    </Action_RemoveQuestMarkers>                                
                            </Sequence>
                            
                             <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression04"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                 <Action_RemoveQuestMarkers>
                                     <Input_Markers VarName="$Marker01"/>
                                 </Action_RemoveQuestMarkers>
                                 <Action_RemoveQuestMarkers>
                                     <Input_Markers VarName="$Marker02"/>
                                 </Action_RemoveQuestMarkers>
                                 <Action_RemoveQuestMarkers>
                                     <Input_Markers VarName="$Marker03"/>
                                 </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>
                            
                            <Sequence>
                                <Parallel CompletionPolicy="Any">
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem01"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem02"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem03"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                </Parallel>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>

                            <Sequence>
                                <Parallel CompletionPolicy="Any">
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem01"/>                                          
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem02"/>
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem03"/>
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                </Parallel>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>
                            
                        </Parallel>
                        
                        
                        
                    </Objective>                    
                    <Reward Droplist="DroplistTechnology" EvaluationMethod="Dynamic" Picks="1" PreviewLocalizationKey="%RandomTechnologyTitle"/>
                </ObjectiveSet>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem01"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem02"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker02"/>
                        </Action_AddQuestMarkers>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem03"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker03"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression05"/>
                                    </Condition_CheckInterpreter>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression06"/>
                                    </Condition_CheckInterpreter>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression07"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>
                            <Sequence>
                                <Parallel CompletionPolicy="First">
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem01"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem02"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem03"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>                                  
                                </Parallel>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>

                            <Sequence>
                                <Parallel CompletionPolicy="First">
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem01"/>
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem02"/>
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_SystemDecolonized Initiator="Empire">
                                            <Input_Systems VarName="$StarSystem03"/>
                                        </Decorator_SystemDecolonized>
                                    </Sequence>
                                </Parallel>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>
                            
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression04"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker03"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                    <Reward Droplist="DroplistTechnology" EvaluationMethod="Dynamic" Picks="1" PreviewLocalizationKey="%RandomTechnologyTitle"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
    
     <!--           POPULATION QUEST 12       -->
    <!--                   HORATIO              -->


   <QuestDefinition Name="PopulationQuest12" Category="PopulationQuest" SubCategory="Population" MinimumTurn="30" TriggeringProbability="1">
   
        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$MyColonizedStarSystems">              
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ClassColonizedStarSystem/ClassPopulationStarSystemAffinityHoratio</PathPrerequisite>
                        </Where>
                    </From>                
            </Var>
            
            <Var VarName="$ColonizedStarSystem01">
                <Any>
                    <From Source="$MyColonizedStarSystems"/>
                </Any>
            </Var>
            <Var VarName="$ColonizedStarSystem02">
                <Any>
                    <From Source="$MyColonizedStarSystems">
                        <Where>
                            <IsNot EntityVarName="$ColonizedStarSystem01"/>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$StarSystem01">
                <From Source="$ColonizedStarSystem01.$StarSystem"/>
            </Var>
            <Var VarName="$StarSystem02">
                <From Source="$ColonizedStarSystem02.$StarSystem"/>
            </Var>
            
            <Var VarName="$Path"    StringValue="ClassEmpire/ClassColonizedStarSystem"/>
            <Var VarName="$SubPath" StringValue="ClassColonizedStarSystem/ClassColonizedPlanet/ClassPopulationPlanet"/>
            <Var VarName="$Tag"     StringValue="ClassPopulationPlanetAffinityHoratioCount"/>          
            <Var VarName="$Amount02" IntValue="3"/>
            
            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassColonizedStarSystem',SystemProduction) ge ($(Amount03)+50)"/>
            <Var VarName="$Expression02" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityHoratioCount', PopulationCount, true) lt 1"/>
            <Var VarName="$Timer"/>   
            
            <InterpretedVar VarName="$Amount03">
                <Expression>Max((Property(ColonizedStarSystem01, @'ClassColonizedStarSystem',SystemProduction)),(Property(ColonizedStarSystem01, @'ClassColonizedStarSystem',SystemProduction)))</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$Amount04">
                <Expression>$(Amount03)+50</Expression>
            </InterpretedVar>
              <InterpretedVar VarName="$TurnAmount" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*20</Expression>
            </InterpretedVar>
            
            
            
            <LocalizationVar Source="$StarSystem01" LocalizationKey="$StarSystem01Name"/>
            <LocalizationVar Source="$StarSystem02" LocalizationKey="$StarSystem02Name"/>
            <LocalizationVar Source="$Expression01" LocalizationKey="$Expression01Name"/>
            <LocalizationVar Source="$Amount02"     LocalizationKey="$Amount02Name"/>
            <LocalizationVar Source="$Amount04"     LocalizationKey="$Amount04Name"/>
            <LocalizationVar Source="$TurnAmount"   LocalizationKey="$TurnAmountName"/>
        
        </Vars>


        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">               
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityHoratioCount', PopulationCount, true) ge 10</InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpire,!ClassPopulationEmpireAffinityHoratioCount', PopulationCount, true) ge 1</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">      
                
               <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>                   
                </Choice>
                
                <ObjectiveSet>                    
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                 <Decorator_BeginTurn>                                   
                                    <Condition_CountSimulationObjectsWithTag Composition="Minimum" SubComposition="All">
                                        <Input_SimulationObjects VarName="$CurrentEmpire"/>
                                        <Input_Path VarName="$Path"/>
                                        <Input_SubPath VarName="$SubPath"/>
                                        <Input_Tag VarName="$Tag"/>
                                        <Input_Minimum VarName="$Amount02"/>                                       
                                    </Condition_CountSimulationObjectsWithTag>
                                </Decorator_BeginTurn>
                            </Sequence>

                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression02"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            
                        </Parallel>
                    </Objective>
                    <Reward Droplist="DroplistPrestigeEra2" Picks="1"/>
                </ObjectiveSet>  
            
                <ObjectiveSet>                    
                    <StartActions>
                        <Action_StartTimer>
                            <Input_Duration VarName="$TurnAmount"/>
                            <Output_Timer VarName="$Timer"/>
                        </Action_StartTimer>
                    </StartActions>
                    <Objective Name="Step1_Objective2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$ColonizedStarSystem01"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                 <Condition_CheckInterpreter>
                                        <Input_Context VarName="$ColonizedStarSystem02"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                            </Sequence>

                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_CheckInterpreter>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression02"/>
                                    </Condition_CheckInterpreter>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_TimerEnded>
                                        <Input_Timer VarName="$Timer"/>
                                    </Condition_TimerEnded>
                                </Decorator_BeginTurn>
                                <Action_Fail/>
                            </Sequence>
                            
                            <Sequence>
                                <Parallel CompletionPolicy="Any">
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem01"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$StarSystem02"/>
                                        </Decorator_InvadeSystem>
                                    </Sequence>                                    
                                </Parallel>
                             <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                    <Reward Droplist="DroplistPrestigeEra2" Picks="1"/>
                </ObjectiveSet>  
            </Step>
        </Steps>
    </QuestDefinition>


    <!--           POPULATION QUEST 13      -->
    <!--             RiftBorn Blues          -->


   <QuestDefinition Name="PopulationQuest13" Category="PopulationQuest" SubCategory="Population" MinimumTurn="25" TriggeringProbability="0.6"> 

        <!--============ TAGS ============-->
        <Tags>BeginTurn</Tags>

        <QuestContextSolo/>

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$Path" StringValue="ClassEmpire/ClassColonizedStarSystem"/>
            <Var VarName="$SubPath" StringValue="ClassColonizedStarSystem/ClassColonizedPlanet"/>            

            <Var VarName="$Expression02" StringValue="Count(Context, @'ClassEmpire/ClassColonizedStarSystem/ClassColonizedPlanet,PlanetGameplayTypeCold')"/>
            
            <InterpretedVar VarName="$Amount01" Target="$(Empire)">
                <Expression>Count(Context, @'ClassEmpire/ClassColonizedStarSystem/ClassColonizedPlanet,PlanetGameplayTypeCold')</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$Amount02" Target="$(Empire)">
                <Expression>Count(Context, @'ClassEmpire/ClassColonizedStarSystem/ClassColonizedPlanet,PlanetGameplayTypeCold')+2</Expression>
            </InterpretedVar>
            
            <Var VarName="$Expression01" StringValue="Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityTimeLordsCount', PopulationCount, true) lt 1"/>
            
            <LocalizationVar Source="$Amount01" LocalizationKey="$Amount01Name"/>
            <LocalizationVar Source="$Amount02" LocalizationKey="$Amount02Name"/>

        </Vars>


        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityTimeLordsCount', PopulationCount, true) ge 12 </InterpreterPrerequisite>
            <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @ClassEmpire/ClassResearch, TechnologyQuadrantScienceAndExplorationActualStageNumber) ge 3</InterpreterPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>     
                    <Objective Name="Step1_Objective1" StartValue="$Amount01" EndValue="$Amount02">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_IsProgressionComplete>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_EmpireWhoseProgressToUpdate VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression02"/>
                                    </Condition_IsProgressionComplete>
                                </Decorator_BeginTurn>
                                <Action_ChooseOutcome Name="Outcome1"/>
                            </Sequence>
                            <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_CheckInterpreter>
                                    <Input_Context VarName="$CurrentEmpire"/>
                                    <Input_Expression VarName="$Expression01"/>
                                </Condition_CheckInterpreter>
                            </Decorator_BeginTurn>
                            <Action_Fail/>
                            </Sequence>
                        </Parallel>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>PopulationQuest14</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMinorRewards" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!--           POPULATION QUEST 14       -->
    <!--             RiftBorn Blues          -->


    <QuestDefinition Name="PopulationQuest14" Category="PopulationQuest" SubCategory="TriggerByQuest">

        <!--============ TAGS ============-->
        <Tags>PopulationQuest14</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
          <Var VarName="$MyColonizedStarSystem">
              <Any>
                  <From Source="$CurrentEmpire.$ColonizedStarSystems">
                      <Where>
                          <InterpreterPrerequisite Flags="Prerequisite">Count(Context, @'ClassColonizedStarSystem/ClassColonizedPlanet,PlanetGameplayTypeCold') ge 1</InterpreterPrerequisite>
                          <InterpreterPrerequisite Flags="Prerequisite">Property(Context, @'ClassColonizedStarSystem', SystemLevel) lt 5 </InterpreterPrerequisite>
                      </Where>
                  </From>
              </Any>
          </Var>
            <Var VarName="$MyColonizedStarSystemLocalization">
                <From Source="$MyColonizedStarSystem.$StarSystem"/>
            </Var>
            <Var VarName="$MyColonizedStarSystemLocalizationGUID"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Expression01" StringValue="(Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityTimeLordsCount', PopulationCount, true) lt 1)"/>
   
            <LocalizationVar Source="$MyColonizedStarSystemLocalization" LocalizationKey="$MyColonizedStarSystemLocalizationName"/>
        </Vars>

        <!--============ PREREQUISITES ============-->              
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step01">
                <ObjectiveSet>
                    <StartActions>
                        <Action_AddQuestMarkers>                            
                            <Input_Targets VarName="$MyColonizedStarSystemLocalization"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="17" MaxAutoResolutionTurn="25" AutoResolutionProbability="0.75" />
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_SystemLevelChanged Initiator="Empire">                                    
                                    <Input_System VarName="$MyColonizedStarSystemLocalization"/>
                                    <Output_StarSystem VarName="$MyColonizedStarSystemLocalizationGUID"/>
                                </Decorator_SystemLevelChanged>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>
                            <Sequence>
                                <Parallel CompletionPolicy="First">
                                    <Sequence>
                                        <Decorator_BeginTurn>
                                            <Condition_CheckInterpreter>
                                                <Input_Context VarName="$CurrentEmpire"/>
                                                <Input_Expression VarName="$Expression01"/>
                                            </Condition_CheckInterpreter>
                                        </Decorator_BeginTurn>
                                        <Action_Fail/>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_InvadeSystem Initiator="OtherEmpires">
                                            <Input_System VarName="$MyColonizedStarSystemLocalization"/>
                                        </Decorator_InvadeSystem>                                                                   
                                    </Sequence>
                                </Parallel>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMinorRewards" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>
    
</Datatable>