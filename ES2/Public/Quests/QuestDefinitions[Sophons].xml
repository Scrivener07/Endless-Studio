<?xml version="1.0" encoding="utf-8" ?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:noNamespaceSchemaLocation="../Schemas/QuestDefinition.xsd">

    <!-- ####################################### -->
    <!--                SOPHONS QUEST            -->
    <!-- ####################################### -->
   
    <!-- ##### Sophons QUEST 00 #####-->

    <QuestDefinition Name="SophonsQuest-Chapter0" Category="Test" SubCategory="">

       <!--============ TAGS ============-->
        <Tags>Hidden, BeginTurn</Tags>

        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

       <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$AllStarSystems">
                <From Source="$Constellations.$StarSystems">
                    <Where>
                        <PathPrerequisite Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>
                    </Where>
                </From>
            </Var>        
            <Var VarName="$ENFERSystem" IsGlobal="true" AutoLockTargets="true">
                <First>
                    <From Source="$AllStarSystems">                       
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Nearest" MinimumDistance="1" MinimumCandidateCount="1" ConsiderFreeMovement="true"/>
                        </OrderBy>
                    </From>
                </First>
            </Var>           
            <Var VarName="$DefinitionName01" StringValue="QuestNodeENFER"/>
            
        </Vars>

       <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinitySophons,PopulationMajor</PathPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Step1_Objective1">
                        <!-- Wait for 5 turns -->
                        <AIHint Category="Minimal" />
                        <Sequence>                          
                            <Action_ApplyStarSystemDefinition>
                                <Input_DefinitionName VarName="$DefinitionName01"/>
                                <Input_StarSystemNode VarName="$ENFERSystem"/>
                            </Action_ApplyStarSystemDefinition>
                                <Decorator_BeginTurn/>                             
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
    
    <QuestDefinition Name="SophonsQuest-Chapter1" Category="MajorQuest" SubCategory="Sophons" MinimumTurn="5" CheckRandom="false" AlternateVersion="SophonsQuest-Chapter1Alt">

        <!--============ TAGS ============-->
        <Tags>BeginTurn,SophonsQuest-Chapter1</Tags>

        <QuestContextSolo/>

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <!--System and location we need in this Quest-->
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$HomeStarSystem"/>
            </Var>
            <Var VarName="$HomeConstellation">
                <From Source="$HomeSystem.$Constellation"></From>
            </Var>
            <Var VarName="$AnotherConstellation">
                <From Source="$Constellations">
                    <Where>
                        <IsNot EntityVarName="$HomeConstellation"/>
                    </Where>
                </From>
            </Var>
            <!--All Systems in all Constellation except mine-->
            <Var VarName="$AnotherSystems">
                <From Source="$AnotherConstellation.$StarSystems"></From>
            </Var>
            <!--All Isolated Nodes in the Galaxy-->
            <Var VarName="$IsolatedNodes">
                <From Source="$Constellations.$StarSystems">
                    <Where> 
                        <PathPrerequisite Flags="Prerequisite">ClassStarSystem,IsolatedNode</PathPrerequisite>
                        <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>
                    </Where>
                </From>  
            </Var>
            <Var VarName="$Amount01" IntValue="3"/>
            <LocalizationVar LocalizationKey="$Amount01Name" Source="$Amount01"/>
            <Var VarName="$Amount02" IntValue="2"/>
            <LocalizationVar LocalizationKey="$Amount02Name" Source="$Amount02"/>
            <!--Minor Faction Step2_3-->
           
            <Var VarName="$MinimumRelationPoints"  IntValue="90"/>            
            <Var VarName="$JustOne" IntValue="1"/>             
            <LocalizationVar LocalizationKey="$RelationPoints" Source="$MinimumRelationPoints"/>
            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectMilitary" StringValue="PopulationEventSophons01Military"/>
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons01Science"/>
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons01Pacifist"/>
            
        </Vars>

        <!--============ PREREQUISITES ============-->
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinitySophons,PopulationMajor</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassStarSystem,HomeSystem</PathPrerequisite>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="SophonsQuest-Chapter1Alt" QuestState="InProgress"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="SophonsQuest-Chapter1Alt" QuestState="Completed"/>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <!--============ STEP 1 - Choose ============-->
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>

                <!--============ OBJECTIVE SET 0 - Military ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitary"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_1_Objective1" StartValue="0" EndValue="3">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <!--Survive to a battle 3 times with ENFER-->
                                    <Loop Count="3">
                                        <Decorator_BattleEnded Status="Won" Initiator="Empire" ProgressionIncrement="1">                                            
                                        </Decorator_BattleEnded>
                                    </Loop>                                 
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>                              
                                <Sequence>
                                    <Decorator_InvadeSystem Initiator="OtherEmpires">
                                        <Input_System VarName="$HomeSystem"/>
                                        <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                    </Decorator_InvadeSystem>
                                    <Action_Fail/>
                                </Sequence>
                                </Parallel>  
                             </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1-Militarist</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest02" Picks="1"/>
                </ObjectiveSet>

                <!--============ OBJECTIVE SET 1 - Science ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_2_Objective1" StartValue="0" EndValue="2">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <!--Reveal 3 Star Systems-->                                            
                        <Parallel CompletionPolicy="Any">
                            <Sequence>
                                <Parallel CompletionPolicy="Any">
                                    <Sequence>
                                        <Loop Count="2">
                                            <Decorator_FleetDocked Initiator="Empire" ProgressionIncrement="1">
                                                <Input_Systems VarName="$AnotherSystems"/>
                                            </Decorator_FleetDocked>
                                        </Loop>        
                                     </Sequence>
                                    <Sequence>
                                        <Loop Count="2">
                                            <Decorator_FleetDocked Initiator="Empire" ProgressionIncrement="1">
                                                <Input_Systems VarName="$IsolatedNodes"/>
                                            </Decorator_FleetDocked>
                                        </Loop>
                                    </Sequence>
                                   <Sequence>
                                         <Parallel CompletionPolicy="All">
                                             <Sequence>
                                                <Decorator_FleetDocked Initiator="Empire">
                                                    <Input_Systems VarName="$AnotherSystems"/>
                                                </Decorator_FleetDocked>
                                             </Sequence>
                                             <Sequence>
                                                 <Decorator_FleetDocked Initiator="Empire">
                                                     <Input_Systems VarName="$IsolatedNodes"/>
                                                 </Decorator_FleetDocked>
                                             </Sequence>
                                        </Parallel>
                                    </Sequence>                                                           
                                </Parallel>
                                  <Action_ChooseOutcome Name="Outcome1"/>    
                            </Sequence>
                            <Sequence>
                                <Decorator_InvadeSystem Initiator="OtherEmpires">
                                    <Input_System VarName="$HomeSystem"/>
                                    <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                </Decorator_InvadeSystem>
                                <Action_Fail/>
                            </Sequence>
                        </Parallel>                                          
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest01" Picks="1"/>
                </ObjectiveSet>

                <!--============ OBJECTIVE SET 2 - Diplomacy ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_3_Objective1">
                        <!-- Reach a high relationship value with a minor faction -->       
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                          
                            <Parallel CompletionPolicy="Any">                                
                                        <Sequence>
                                            <Decorator_InvadeSystem Initiator="OtherEmpires">
                                                <Input_System VarName="$HomeSystem"/>
                                                <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                            </Decorator_InvadeSystem>
                                        <Action_Fail/>
                                        </Sequence>  
                                        <Sequence>
                                            <Decorator_MinorFactionRelation>
                                                <Input_PlayerEmpire VarName="$CurrentEmpire"/>
                                                <Input_MinimumRelationPoints VarName="$MinimumRelationPoints"/>
                                            </Decorator_MinorFactionRelation>                                   
                                            <Action_ChooseOutcome Name="Outcome1"/>
                                        </Sequence>
                                        <Sequence>
                                            <Decorator_MinorEmpireIntegrated Initiator="Empire"/> 
                                            <Action_ChooseOutcome Name="Outcome1"/>
                                        </Sequence>
                            </Parallel>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest03" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <QuestDefinition Name="SophonsQuest-Chapter1Alt" Category="MajorQuest" SubCategory="Sophons" MinimumTurn="5" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>BeginTurn,SophonsQuest-Chapter1</Tags>

        <QuestContextSolo/>

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$HomeStarSystem"/>
            </Var>                                  
                     
            <!--Ship for Step2_2-->     
            <Var VarName="$FivetyPercent" IntValue="50"/>
            <LocalizationVar LocalizationKey="$Percent" Source="$FivetyPercent"/>

            <!--Minor Faction Step2_3-->

            <Var VarName="$MinimumRelationPoints"  IntValue="90"/>         
            
            <LocalizationVar LocalizationKey="$RelationPoints" Source="$MinimumRelationPoints"/>
            <Var VarName="$Amount01" IntValue="3"/>
            <LocalizationVar LocalizationKey="$Amount01Name" Source="$Amount01"/>
            <Var VarName="$Amount03" IntValue="3"/>
            <LocalizationVar LocalizationKey="$Amount03Name" Source="$Amount03"/>            

            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectMilitary" StringValue="PopulationEventSophons01Military"/>
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons01Science"/>
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons01Pacifist"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinitySophons,PopulationMajor</PathPrerequisite>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="SophonsQuest-Chapter1" QuestState="InProgress"/>
            <QuestStatePrerequisite Flags="Prerequisite" Inverted="true" QuestDefinitionName="SophonsQuest-Chapter1" QuestState="Completed"/>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassStarSystem,HomeSystem</PathPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <!--============ STEP 1 - Choose ============-->
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>

                <!--============ OBJECTIVE SET 0 - Military ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitary"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_1_Objective1" StartValue="0" EndValue="3">
                        <!-- Survive 3 battle -->       
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                            
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <!--Survive to a battle 3 times with ENFER-->
                                    <Loop Count="3">
                                        <Decorator_BattleEnded Status="Won" Initiator="Empire" ProgressionIncrement="1">                                            
                                        </Decorator_BattleEnded>
                                    </Loop>                                    
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                                <Sequence>
                                    <Decorator_InvadeSystem Initiator="OtherEmpires">
                                        <Input_System VarName="$HomeSystem"/>
                                        <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                    </Decorator_InvadeSystem>
                                    <Action_Fail/>
                                </Sequence>                              
                            </Parallel>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1-Militarist</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest02" Picks="1"/>
                </ObjectiveSet>

                <!--============ OBJECTIVE SET 1 - Science ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_2_Objective1">
                        <!--Reveal 3 Star Systems-->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                            
                            <Parallel CompletionPolicy="First">
                                <Sequence>
                                    <Decorator_ExploredNode MinimumState="Revealed" Initiator="Empire">
                                        <Input_MinimumPercentage VarName="$FivetyPercent"/>
                                    </Decorator_ExploredNode>            
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_ExplorationProgress MinimumState="Revealed">
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_Percentage VarName="$FivetyPercent"/>
                                        </Condition_ExplorationProgress>
                                    </Decorator_BeginTurn>
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                                <Sequence>
                                    <Decorator_InvadeSystem Initiator="OtherEmpires">
                                        <Input_System VarName="$HomeSystem"/>
                                        <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                    </Decorator_InvadeSystem>
                                    <Action_Fail/>
                                </Sequence>                               
                            </Parallel>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1Alt-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest01" Picks="1"/>
                </ObjectiveSet>

                <!--============ OBJECTIVE SET 2 - Diplomacy ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_3_Objective1">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                           
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_MinorFactionRelation>
                                        <Input_PlayerEmpire VarName="$CurrentEmpire"/>
                                        <Input_MinimumRelationPoints VarName="$MinimumRelationPoints"/>
                                    </Decorator_MinorFactionRelation>                                  
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                                <Sequence>
                                    <Decorator_InvadeSystem Initiator="OtherEmpires">
                                        <Input_System VarName="$HomeSystem"/>
                                        <Input_VictimEmpire VarName="$CurrentEmpire"/>
                                    </Decorator_InvadeSystem>
                                    <Action_Fail/>
                                </Sequence>
                                <Sequence>
                                    <Decorator_MinorEmpireIntegrated Initiator="Empire"/>
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                            </Parallel>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.1-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistSophonsQuest03" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
    <!-- ####################################### -->
    <!--           Chapter 2.1 - Military          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.1-Military" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS  ============-->
        <Tags>Chapter2.1-Militarist</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
        <!--Military Politic-->
            <Var VarName="$PoliticsName" StringValue="Politics06"/>
        <!--Percentage = 30% -->
            <Var VarName="$MinimumPercentage" IntValue="30"/>
        <!--In X Systems -->
            <Var VarName="$MinimumSystemAmount" IntValue="3"/>
         <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectMilitary" StringValue="PopulationEventSophons02.1Military"/>
            <LocalizationVar Source="$MinimumPercentage" LocalizationKey="$MinimumPercentageName"/>
            <LocalizationVar Source="$MinimumSystemAmount" LocalizationKey="$MinimumSystemAmountName"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
      
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitary"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="20" AutoResolutionProbability="1" />
                        <Sequence>
                            <!--In X Systems, reach X Politic Score-->
                            <Decorator_BeginTurn>
                                <Condition_HasPoliticsScore>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_PoliticsName VarName="$PoliticsName"/>
                                    <Input_MinimumPercentage VarName="$MinimumPercentage"/>
                                    <Input_MinimumSystemAmount VarName="$MinimumSystemAmount"/>
                                </Condition_HasPoliticsScore>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.2-Militarist</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMinorRewardsEra3" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>


    <!-- ####################################### -->
    <!--           Chapter 2.2 - Military          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.2-Military" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.2-Militarist</Tags>
       

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <!--Use the SubCategoryInQuests-->
            <Var VarName="$TechnoSubCategory" StringValue="TechnoMilitary"/>
            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectMilitary" StringValue="PopulationEventSophons02.2Military"/>
            <Var VarName="$Amount01" IntValue="5"/>
            <LocalizationVar Source="$Amount01" LocalizationKey="$Amount01Name"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
    
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitary"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="0" EndValue="5">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="20" AutoResolutionProbability="1" />
                        <Sequence>
                            <!--TO RE DO : 5 MILITARIST TECHNO-->
                            <Loop Count="5">
                                <Decorator_TechnologyUnlocked Initiator="Empire" ProgressionIncrement="1">                                    
                                    <Input_TechnologySubCategory VarName="$TechnoSubCategory"/>
                                </Decorator_TechnologyUnlocked>                               
                            </Loop>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.3-Militarist</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistStrategicsEra2" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.3 - Military          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.3-Military" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->        
        <Tags>Chapter2.3-Militarist</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <!--If you want to use a ship battle in the quest, you can use the tag Ship For Battle-->
            <!--All the Military Ship should have this tag on their hull-->
            <Var VarName="$RequiredTag" StringValue="ShipForBattle"></Var>
            <Var VarName="$PoliticalEffectMilitary" StringValue="PopulationEventSophons02.3Military"/>
             <Var VarName="$Amount01" IntValue="4"/>
            <LocalizationVar Source="$Amount01" LocalizationKey="$Amount01Name"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
       
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitary"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="0" EndValue="4">
                        <!-- Build 4 ships -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="20" AutoResolutionProbability="1" />
                        <Sequence>
                            <Loop Count="4">
                                <Decorator_ShipConstructed ProgressionIncrement="1">
                                    <Input_RequiredTag VarName="$RequiredTag"/>
                                </Decorator_ShipConstructed>
                            </Loop>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter3-Military</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMilitarySophonsQuest01" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>


   
    <!-- ####################################### -->
    <!--           Chapter 2.1 - SCIENCE          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.1-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.1-Science</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <!--OtherShip owner: should be the AI-->

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <Var VarName="$EnemyEmpire">
                <Any>
                    <From Source="$Empires"/>
                </Any>
            </Var>
            <!-- Find the Home System Position -->
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$HomeStarSystem"/>
            </Var>
            <!-- Find the Home Constellation Position -->
            <Var VarName="$HomeConstellation">
                <From Source="$HomeSystem.$Constellation"/>
            </Var>
            <!--Close Constellation: TO DO : find a way to filter by Distance -->
            <Var VarName="$AllConstellationButHome">
                <From Source="$Constellations">
                    <Where>
                        <FilterConstellationByDistance OriginVarName="$HomeConstellation" MinDistance="1"/>
                    </Where>
                </From>
            </Var>
            <Var VarName="$NearestConstellation">
                <First>
                    <From Source="$AllConstellationButHome">
                        <OrderBy>
                            <SortConstellationByDistance OriginVarName="$HomeConstellation" SortBy="Nearest"/>
                        </OrderBy>
                    </From>
                </First>
            </Var>

            <!-- System to Mark -->
            <Var IsGlobal="true" VarName="$SystemToMark">
                <Any>
                    <From Source="$NearestConstellation.$StarSystems">
                        <Where>
                             <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>
                            <FilterSystemByStatus ColonizationState="NotColonized"/>
                        </Where>
                    </From>
                </Any>
            </Var>
            <!-- Planet to set a Curiosity -->
            <Var IsGlobal="true" VarName="$Planet">
                <Any>
                    <From Source="$SystemToMark.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$Marker"/>

            <Var VarName="$CuriosityDefinition03" StringValue="Curiosity_Quest_Sophon3"/>
            <Var VarName="$CuriosityGUID"/>

            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons02.1Science"/>

        </Vars>

        <!--============ PREREQUISITES ============-->
    
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>                   
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$SystemToMark"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">      
                        <!-- Send an explorer to the marked system -->
                        <AIHint Category="Exploration" Motivation="0.6">
                            <Input_Var VarName="$SystemToMark"/>
                        </AIHint>  
                            <Sequence>
                                <Parallel CompletionPolicy="Any">
                                    <Sequence>
                                        <Decorator_FleetDocked Initiator="Empire">
                                            <Input_System VarName="$SystemToMark"/>
                                        </Decorator_FleetDocked>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_BeginTurn>
                                            <Condition_IsFleetDockedOnNode>
                                                <Input_Empire VarName="$CurrentEmpire"/>
                                                <Input_Systems VarName="$SystemToMark"/>
                                            </Condition_IsFleetDockedOnNode>
                                        </Decorator_BeginTurn>
                                    </Sequence>
                                </Parallel>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker"/>
                            </Action_RemoveQuestMarkers>                           
                            <Action_SpawnCuriosity>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Input_Planets VarName="$Planet"/>
                                <Input_CuriosityDefinition VarName="$CuriosityDefinition03"/>
                                <Output_CuriosityGUIDs VarName="$CuriosityGUID"/>
                            </Action_SpawnCuriosity>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.2-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMoneyEra2" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.1 ALT - SCIENCE          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.1Alt-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.1Alt-Science</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <!--OtherShip owner: should be the AI-->

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <Var VarName="$EnemyEmpire">
                <Any>
                    <From Source="$Empires"/>
                </Any>
            </Var>
            <!-- Find the Home System Position -->
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$HomeStarSystem"/>
            </Var>


            <Var IsGlobal="true" VarName="$FarSystem">
                <First>
                    <From Source="$HomeSystem.$Constellation.$StarSystems">
                        <Where>
                            <FilterSystemByStatus ColonizationState="NotColonized"/>
                            <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>
                        </Where>
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Farthest" MinimumDistance="50" MaximumDistance="65" MinimumCandidateCount="1"/>
                        </OrderBy>
                    </From>
                </First>
            </Var>

            <Var IsGlobal="true" VarName="$OnePlanet">
                <Any>
                    <From Source="$FarSystem.$Planets"/>
                </Any>
            </Var>

            <Var VarName="$Marker"/>


            <Var VarName="$CuriosityDefinition01" StringValue="Curiosity_Quest_Sophon4"/>           
            <Var VarName="$CuriosityGUID"/>
            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons02.1Science"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
      
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$FarSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Send expeditions to the system's curiosities until you find the right one -->
						<AIHint Category="Curiosity" Motivation="0.6">
							<Input_Var VarName="$FarSystem"/>
						</AIHint>
                        <Sequence>
                        <Parallel CompletionPolicy="Any">
                            <Sequence>
                                <Decorator_FleetDocked Initiator="Empire">
                                    <Input_System VarName="$FarSystem"/>
                                </Decorator_FleetDocked>
                            </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_IsFleetDockedOnNode>
                                        <Input_Empire VarName="$CurrentEmpire"/>
                                        <Input_Systems VarName="$FarSystem"/>
                                    </Condition_IsFleetDockedOnNode>
                                </Decorator_BeginTurn>
                            </Sequence>
                        </Parallel>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker"/>
                            </Action_RemoveQuestMarkers>
                            <!--Spawn the Curiosity for the next Quest-->
                            <Action_SpawnCuriosity>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Input_Planets VarName="$OnePlanet"/>
                                <Input_CuriosityDefinition VarName="$CuriosityDefinition01"/>
                                <Output_CuriosityGUIDs VarName="$CuriosityGUID"/>
                            </Action_SpawnCuriosity>                         
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.2Alt-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistMoneyEra2" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>


    <!-- ####################################### -->
    <!--           Chapter 2.2 - Science          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.2-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.2-Science</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            
            <!--Decorator should work with only the Name NOT with the QuestType-->
            <Var VarName="$CuriosityType" StringValue="CuriosityTypeQuest"/>
            

            <Var IsGlobal="true" VarName="$PlaceToBe"/>
            <Var IsGlobal="true" VarName="$SystemToMark"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Marker02" IsGlobal="true"/>
            <DroplistVar VarName="$FleetToSpawn01" Droplist="ENFERShip01"/>           
            <Var VarName="$SpawnedFleet01"/>
            <Var VarName="$GUID01"/>
            <Var VarName="$NoBattle" StringValue="CannotFight"/>
            <Var VarName="$StayInFleet" StringValue="DisbandOnlyGarrison"/>
            <Var VarName="$ENFERfleet"/>
            
            <Var IsGlobal="true" VarName="$FarSystem"/>

            <Var IsGlobal="true" VarName="$Planet"/>

            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons02.2Science"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
      
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>                       
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$Planet"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Explore curiosities -->
                        <!--<AIHint Category="Curiosity" Motivation="0.6">
							<Input_Var VarName="$PlaceToBe"/>
						</AIHint>-->
                        <Sequence>                            
                                <Decorator_CuriosityDiscovered Initiator="Empire">                              
                                    <Input_DisplayedType VarName="$CuriosityType"/>                    
                                    <Output_Node VarName="$PlaceToBe"/>                                 
                                </Decorator_CuriosityDiscovered>                       
                            <Action_SpawnFleets>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_Locations VarName="$PlaceToBe"/>
                                <Input_DroppableFleet VarName="$FleetToSpawn01"/>
                                <Output_FleetGUIDs VarName="$GUID01"/>
                            </Action_SpawnFleets>
                            <Decorator_EntityCreated>
                                <Input_GUID VarName="$GUID01"/>
                                <Output_Entity VarName="$ENFERfleet"/>
                            </Decorator_EntityCreated>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$NoBattle"/>
                                <Input_Targets VarName="$ENFERfleet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$StayInFleet"/>
                                <Input_Targets VarName="$ENFERfleet"/>                                
                            </Action_ApplyDescriptor>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_AddQuestMarkers>
                                <Input_Targets VarName="$ENFERfleet"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker02"/>
                            </Action_AddQuestMarkers>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                      <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter2.3-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistStrategicsEra2" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.2 ALT- Science          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.2Alt-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.2Alt-Science</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <!--Decorator should work with only the Name NOT with the QuestType-->
            <Var VarName="$CuriosityType" StringValue="CuriosityTypeQuest"/>

            <Var IsGlobal="true" VarName="$FarSystem"/>
                
            <Var IsGlobal="true" VarName="$PlaceToBe"/>

            <DroplistVar VarName="$FleetToSpawn01" Droplist="ENFERShip01"/>
            <Var VarName="$SpawnedFleet01"/>
            <Var VarName="$GUID01"/>
            <Var VarName="$Marker01"/>
            <Var IsGlobal="true" VarName="$Marker02"/>
            <Var VarName="$NoBattle" StringValue="CannotFight"/>
            <Var VarName="$StayInFleet" StringValue="DisbandOnlyGarrison"/>
            <Var VarName="$ENFERfleet"/>           
            <Var IsGlobal="true" VarName="$OnePlanet"/>
            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons02.2Science"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
      
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$OnePlanet"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Explore curiosities -->
                        <AIHint Category="Minimal"/>
                        <Sequence>                            
                               <Decorator_CuriosityDiscovered Initiator="Empire">                                    
                                    <Input_DisplayedType VarName="$CuriosityType"/>
                                    <Output_Node VarName="$PlaceToBe"/>
                                </Decorator_CuriosityDiscovered>                           
                            <Action_SpawnFleets>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_Locations VarName="$PlaceToBe"/>
                                <Input_DroppableFleet VarName="$FleetToSpawn01"/>
                                <Output_FleetGUIDs VarName="$GUID01"/>
                            </Action_SpawnFleets>
                            <Decorator_EntityCreated>
                                <Input_GUID VarName="$GUID01"/>
                                <Output_Entity VarName="$ENFERfleet"/>
                            </Decorator_EntityCreated>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$NoBattle"/>
                                <Input_Targets VarName="$ENFERfleet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$StayInFleet"/>
                                <Input_Targets VarName="$ENFERfleet"/>
                            </Action_ApplyDescriptor>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_ChooseOutcome Name="Outcome1"/>
                            <Action_AddQuestMarkers>
                                <Input_Targets VarName="$ENFERfleet"/>
                                <Input_Empires VarName="$CurrentEmpire"/>                                
                                <Output_Markers VarName="$Marker02"/>
                            </Action_AddQuestMarkers>                            
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter2.3-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>                       
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistStrategicsEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>


    <!-- ####################################### -->
    <!--           Chapter 2.3 - Science          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.3-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter2.3-Science</Tags>

            <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
           
            <Var VarName="$ColonizedSystem">                
                    <From Source="$CurrentEmpire.$ColonizedStarSystems"/>              
            </Var>
            <Var VarName="$ColonizedSystemHangar">
                <From Source="$ColonizedSystem.$Hangar"/>
            </Var>

            <Var VarName="$ColonizedSystemLocation">
                <From Source="$ColonizedSystem.$StarSystem"/>
            </Var>

            <Var VarName="$Module01" StringValue="ModuleExplorationQuestSophons"/>
            <Var VarName="$Amount" IntValue="1"/>

            <Var VarName="$ENFERScience" StringValue="ShipDesignENFERScience"/>
            <Var IsGlobal="true" VarName="$PlaceToBe"/>
            <DroplistVar VarName="$FleetToSpawn01" Droplist="ENFERShip01"/>
            <Var VarName="$GUID01"/>
            <!--<LocalizationVar LocalizationKey="$SystemName01"  Source="$ColonizedSystemLocation"/>-->
            <Var IsGlobal="true" VarName="$Marker02"/>
            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectScience" StringValue="PopulationEventSophons02.3Science"/>

            <Var VarName="$Path" StringValue="ClassEmpire/ClassColonizedStarSystem/ClassGarrison/ClassShip/ClassSectionCore/ClassModuleSupportExplorationQuestSophons"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
      
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScience"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Bring the alien ship to the hanger in one of your systems -->
                        <AIHint Category="Minimal"/>
                        <!--
                        <AIHint Category="ReturnToBase" Motivation="0.5">
							<Input_Var VarName="$GUID01"/>
						</AIHint>-->
                        <Sequence>
                        <Parallel CompletionPolicy="All">
                        <Sequence>
                            <Decorator_ShipDisbanded>
                                <Input_ModuleName VarName="$Module01"/>
                            </Decorator_ShipDisbanded>
                        </Sequence>
                            <Sequence>
                                <Decorator_BeginTurn/>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>   
                            </Sequence>
                        </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter3-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>                        
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistScienceSophonsQuest02" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.1 - Diplomacy          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.1-Diplomacy" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.1-Diplomacy</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <!--   Define a Hangar of a Random System in the Colonized Star System which is not a Home System-->
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var IsGlobal="true" VarName="$ColonizedSystem01">
                <Any>
                    <From Source="$CurrentEmpire.$ColonizedStarSystems">
                        <Where>
                            <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassColonizedStarSystem,ColonizedStarSystemStateOutpost</PathPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$Hangar">
                <From Source="$ColonizedSystem01.$Hangar"/>
            </Var>
            <Var VarName="$ColonizedSystemLocation">
                <From Source="$ColonizedSystem01.$StarSystem"></From>
            </Var>

            <Var VarName="$Expression01" StringValue="Count(ColonizedSystem01, @'ClassColonizedStarSystem/ClassGarrison/ClassShip,ShipForBattle,!ShipRoleHero') ge 2"/>

            <!-- Define a Hull and an amount of Ship requiered-->
            <Var VarName="$MinimumAmount" IntValue="2"/>
            <Var VarName="$MinimumAmount02" IntValue="1"/>
            <!--Decorator should count the SHIP whatever the hulls/modules are-->
            <Var VarName="$BattleShipTag" StringValue="ShipForBattle"/>

            <LocalizationVar LocalizationKey="$SystemName01" Source="$ColonizedSystemLocation"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01" IntValue="2"/>
            <LocalizationVar Source="$Amount01" LocalizationKey="$Amount01Name"/>
            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons02.1Pacifist"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
       
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$ColonizedSystemLocation"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Garrison 2 Military Ships in the system at the same time. -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="15" MaxAutoResolutionTurn="20" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_CheckInterpreter>
                                    <Input_Context VarName="$CurrentEmpire"/>
                                    <Input_Expression VarName="$Expression01"/>
                                </Condition_CheckInterpreter>
                            </Decorator_BeginTurn>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.2-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistLuxuriesEra2" Picks="1"/>
            </Step>

        </Steps>

    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.2 - Diplomacy          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.2-Diplomacy" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.2-Diplomacy</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <!--   Define the Hangar-->
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <Var IsGlobal="true" VarName="$ColonizedSystem01"/>
            <Var VarName="$ColonizedSystemLocation">
                <From Source="$ColonizedSystem01.$StarSystem"/>
            </Var>
            <!--<Var VarName="$MinimumAmount" IntValue="70"/>-->
            
            <InterpretedVar VarName="$MinimumAmount">
                <Expression>Min(100,Property(ColonizedSystem01, @'ClassColonizedStarSystem', Happiness) + 15)</Expression>
            </InterpretedVar>
            
            <Var VarName="$Marker01"/>

            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons02.2Pacifist"/>

            <LocalizationVar LocalizationKey="$SystemName01" Source="$ColonizedSystemLocation"/>
            <LocalizationVar LocalizationKey="$Amount" Source="$MinimumAmount"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
 
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$ColonizedSystemLocation"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Reach an approval threshold on a specific system -->
						<AIHint Category="MaximizeResourceOnSystem" Motivation="0.5">
							<Resource>Approval</Resource>
							<Input_Var VarName="$ColonizedSystem01"/>
						</AIHint>  
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasHappiness>
                                    <!--Reach XX Approval on SystemName-->
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_System VarName="$ColonizedSystemLocation"/>
                                    <Input_MinimumAmount VarName="$MinimumAmount"/>
                                </Condition_HasHappiness>
                            </Decorator_BeginTurn>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>Chapter2.3-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistPrestigeEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 2.3 - Diplomacy          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter2.3-Diplomacy" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter2.3-Diplomacy</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <Var IsGlobal="true" VarName="$ColonizedSystem01"/>
            <Var VarName="$ColonizedSystemLocation">
                <From Source="$ColonizedSystem01.$StarSystem"/>
            </Var>
            
            <!--<Var VarName="$Amount" IntValue="20"/>-->

            <InterpretedVar VarName="$Amount" Target="$(Empire)">
                <Expression>MaxProperty(Context, @'ClassEmpire/ClassColonizedStarSystem', NetSystemEmpirePoint) + 15</Expression>
            </InterpretedVar>
            
            <Var VarName="$SystemCount" IntValue="2"/>
            <LocalizationVar LocalizationKey="$SystemAmount" Source="$SystemCount"/>
            <LocalizationVar LocalizationKey="$AmountLoc" Source="$Amount"/>          
            <LocalizationVar LocalizationKey="$SystemName01" Source="$ColonizedSystemLocation"/>

            <!--POLITICAL EFFECT -->
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons02.3Pacifist"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
     

        <!--============ STEPS ============-->
        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- Generate 20 Influence per turn in at least 2 Systems -->
						<AIHint Category="MaximizeResource" Motivation="0.5">
							<Resource>EmpirePoint</Resource>
						</AIHint>
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_SystemsHaveFidsi>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_SystemCount VarName="$SystemCount"/>                                    
                                    <Input_NetEmpirePoint VarName="$Amount"/>
                                </Condition_SystemsHaveFidsi> 
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter3-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistDiplomacySophonsQuest01" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
   <!--           Chapter 3 - Military          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter3-Military" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false" AlternateVersion="SophonsQuest-Chapter3-Military-Alt">

      <!--============ TAGS ============-->
        <Tags>Chapter3-Military</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

       <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$AllEmpires">
                <From Source="$Empires"/>
            </Var>
            <Var VarName="$IAEmpire">
                <From Source="$LesserEmpire"/>
            </Var>
          
            <Var VarName="$Amount01" IntValue="2"/>
            <Var VarName="$PopAffinity" StringValue="AffinityMavros"/>

           <Var VarName="$MySystems">
                <From Source="$CurrentEmpire.$ColonizedStarSystems"/>
            </Var>
            <Var VarName="$AvailableSystem">
                <Any>
                    <From Source="$MySystems">
                        <Where>
                            <InterpreterPrerequisite Flags="Prerequisite">((Property(Context, @'ClassColonizedStarSystem', MaximumPopulation))-(Property(Context, @'ClassColonizedStarSystem', Population))) ge 2</InterpreterPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var>
            <Var VarName="$AvailableStarSystem">
                <From Source="$AvailableSystem.$StarSystem"/>
            </Var>
            <Var VarName="$Marker01"/>

            <InterpretedVar VarName="$MinimumAmout01" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', EmpireManpowerStock) + 500</Expression>
            </InterpretedVar>
            <Var VarName="$MinimumAmout02" IntValue="75"/>
            <Var VarName="$PoliticalEffectMilitarist" StringValue="PopulationEventSophons03Military"/>
            <Var VarName="$PoliticalEffectScientist"  StringValue="PopulationEventSophons03Scientist"/>
            <Var VarName="$PoliticalEffectPacifist"   StringValue="PopulationEventSophons03Pacifist"/>
            <InterpretedVar VarName="$MinimumAmount03" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire/ClassPopulationEmpireAffinityMavros', PopulationCount, true) + 5</Expression>
            </InterpretedVar>       
            <LocalizationVar LocalizationKey="$MinimumAmout01Name" Source="$MinimumAmout01"/>
            <LocalizationVar LocalizationKey="$MinimumAmout02Name" Source="$MinimumAmout02"/>
            <LocalizationVar LocalizationKey="$MinimumAmount03Name" Source="$MinimumAmount03"/>
            <LocalizationVar LocalizationKey="$AvailableSystemName" Source="$AvailableSystem"/>
        </Vars>

     <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,EmpireTypeMajor,AffinityGameplayVampirilis</PathPrerequisite>       
        </Prerequisites>
        
     <!--============ STEPS ============-->
        <Steps>
            
      <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitarist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>    
                            <Action_AddQuestMarkers>
                                <Input_Targets VarName="$AvailableStarSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>
                           <Action_SpawnPopulation>                               
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$AvailableStarSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Decorator_BeginTurn/>
                             <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Decorator_BeginTurn>
                                <Condition_HasManpower>                                   
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmout01"/>                                   
                                </Condition_HasManpower>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Military</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons08" Picks="1"/>
                </ObjectiveSet>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_Objective1">    
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />                 
                        <Sequence>   
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$AvailableStarSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_ExplorationProgress MinimumState="Revealed">
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_Percentage VarName="$MinimumAmout02"/>
                                        </Condition_ExplorationProgress>
                                    </Decorator_BeginTurn>
                                </Sequence>
                                <Sequence>
                                    <Decorator_ExploredNode MinimumState="Revealed" Initiator="Empire">
                                        <Input_MinimumPercentage VarName="$MinimumAmout02"/>
                                    </Decorator_ExploredNode>
                            </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons09" Picks="1"/>
                </ObjectiveSet>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step3_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>    
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$AvailableStarSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Decorator_BeginTurn/>                            
                            <Decorator_BeginTurn>
                                <Condition_HasPopulationAmount>                                  
                                    <Input_Empire VarName="$CurrentEmpire"/>                                   
                                    <Input_MinimumAmount VarName="$MinimumAmount03"/>  
                                    <Input_PopulationAffinity VarName="$PopAffinity"/>
                                </Condition_HasPopulationAmount>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons10" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    
   <!-- ####################################### -->
   <!--           Chapter 3 - Military ATL      -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter3-Military-Alt" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>Chapter3-Military</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

       <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$AllEmpires">
                <From Source="$Empires"/>
            </Var>
            <InterpretedVar VarName="$MinimumAmout01" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', EmpireManpowerStock) + 500</Expression>
            </InterpretedVar>
            <Var VarName="$MinimumAmout02" IntValue="75"/>
            <InterpretedVar VarName="$MinimumAmount03" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', Population) + 10</Expression>
            </InterpretedVar>
            <Var VarName="$PoliticalEffectMilitarist" StringValue="PopulationEventSophons03.1Military"/>
            <Var VarName="$PoliticalEffectScientist"  StringValue="PopulationEventSophons03.1Scientist"/>
            <Var VarName="$PoliticalEffectPacifist"   StringValue="PopulationEventSophons03.1Pacifist"/>
            <LocalizationVar LocalizationKey="$MinimumAmout01Name" Source="$MinimumAmout01"/>
            <LocalizationVar LocalizationKey="$MinimumAmout02Name" Source="$MinimumAmout02"/>
            <LocalizationVar LocalizationKey="$MinimumAmount03Name" Source="$MinimumAmount03"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>

         <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitarist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                                          
                            <Decorator_BeginTurn>
                                <Condition_HasManpower>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmout01"/>
                                </Condition_HasManpower>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Military</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons08" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_ExplorationProgress MinimumState="Revealed">
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_Percentage VarName="$MinimumAmout02"/>
                                        </Condition_ExplorationProgress>
                                    </Decorator_BeginTurn>
                                </Sequence>
                                <Sequence>
                                    <Decorator_ExploredNode MinimumState="Revealed" Initiator="Empire">
                                        <Input_MinimumPercentage VarName="$MinimumAmout02"/>
                                    </Decorator_ExploredNode>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons09" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step3_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                                        
                            <Decorator_BeginTurn>
                                <Condition_HasPopulationAmount>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmount03"/>                                   
                                </Condition_HasPopulationAmount>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons10" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
    
    
    <!-- ####################################### -->
    <!--           Chapter 3 - SCIENCE           -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter3-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

       <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter3-Science</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

       <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <InterpretedVar VarName="$MinimumAmout01" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', EmpireManpowerStock) + 500</Expression>
            </InterpretedVar>
            <Var VarName="$MinimumAmout02" IntValue="75"/>
            <InterpretedVar VarName="$MinimumAmount03" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', Population) + 10</Expression>
            </InterpretedVar>
            <Var VarName="$PoliticalEffectMilitarist" StringValue="PopulationEventSophons03.2Military"/>
            <Var VarName="$PoliticalEffectScientist"  StringValue="PopulationEventSophons03.2Scientist"/>
            <Var VarName="$PoliticalEffectPacifist"   StringValue="PopulationEventSophons03.2Pacifist"/>
            <LocalizationVar LocalizationKey="$MinimumAmout01Name" Source="$MinimumAmout01"/>
            <LocalizationVar LocalizationKey="$MinimumAmout02Name" Source="$MinimumAmout02"/>
            <LocalizationVar LocalizationKey="$MinimumAmount03Name" Source="$MinimumAmount03"/>
        </Vars>

       <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>

           <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitarist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasManpower>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmout01"/>
                                </Condition_HasManpower>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Military</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons08" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_ExplorationProgress MinimumState="Revealed">
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_Percentage VarName="$MinimumAmout02"/>
                                        </Condition_ExplorationProgress>
                                    </Decorator_BeginTurn>
                                </Sequence>
                                <Sequence>
                                    <Decorator_ExploredNode MinimumState="Revealed" Initiator="Empire">
                                        <Input_MinimumPercentage VarName="$MinimumAmout02"/>
                                    </Decorator_ExploredNode>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons09" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step3_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                                               
                            <Decorator_BeginTurn>
                                <Condition_HasPopulationAmount>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmount03"/>                                    
                                </Condition_HasPopulationAmount>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons10" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 3 - Diplomacy           -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter3-Diplomacy" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

      <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter3-Diplomacy</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

       <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$AllEmpires">
                <From Source="$Empires"/>
            </Var>
            
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount02" IntValue="3"/>

            <InterpretedVar VarName="$MinimumAmout01" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', EmpireManpowerStock) + 500</Expression>
            </InterpretedVar>
            <Var VarName="$MinimumAmout02" IntValue="75"/>
            <InterpretedVar VarName="$MinimumAmount03" Target="$(Empire)">
                <Expression>Property(Context, @'ClassEmpire', Population) + 10</Expression>
            </InterpretedVar>
            <Var VarName="$PoliticalEffectMilitarist" StringValue="PopulationEventSophons03.3Military"/>
            <Var VarName="$PoliticalEffectScientist"  StringValue="PopulationEventSophons03.3Scientist"/>
            <Var VarName="$PoliticalEffectPacifist"   StringValue="PopulationEventSophons03.3Pacifist"/>
            <LocalizationVar LocalizationKey="$MinimumAmout01Name" Source="$MinimumAmout01"/>
            <LocalizationVar LocalizationKey="$MinimumAmout02Name" Source="$MinimumAmout02"/>
            <LocalizationVar LocalizationKey="$MinimumAmount03Name" Source="$MinimumAmount03"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

      <!--============ STEPS ============-->
        <Steps>

          <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                </Choice>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitarist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                           
                            <Decorator_BeginTurn>
                                <Condition_HasManpower>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmout01"/>
                                </Condition_HasManpower>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Military</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons08" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_ExplorationProgress MinimumState="Revealed">
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_Percentage VarName="$MinimumAmout02"/>
                                        </Condition_ExplorationProgress>
                                    </Decorator_BeginTurn>
                                </Sequence>
                                <Sequence>
                                    <Decorator_ExploredNode MinimumState="Revealed" Initiator="Empire">
                                        <Input_MinimumPercentage VarName="$MinimumAmout02"/>
                                    </Decorator_ExploredNode>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Science</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons09" Picks="1"/>

                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step3_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>                           
                            <Decorator_BeginTurn>
                                <Condition_HasPopulationAmount>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_MinimumAmount VarName="$MinimumAmount03"/>                                   
                                </Condition_HasPopulationAmount>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>SophonsQuest-Chapter4-Diplomacy</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistRewardQuestSophons10" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>


    <!-- ####################################### -->
    <!--           Chapter 4 - MILITARY          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter4-Military" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter4-Military,FactionFinalQuest,FactionQuestSophons</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$IAEmpire">
                <From Source="$LesserEmpire"/>
            </Var>
            <Var VarName="$ENFERSystem" IsGlobal="true"/>
            <Var VarName="$ENFERPlanet">
                <Any>
                    <From Source="$ENFERSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$ColonizedStarSystemGUID"/>
            <Var VarName="$ColonizedStarSystem"/>
            <Var VarName="$ColonizedPlanetGUID"/>
            <Var VarName="$ColonizedPlanet"/>
            <Var VarName="$SystemControllerName" StringValue="%ENFERName01"/>
            <Var VarName="$NewSystemName" StringValue="%ENFERSystemName01"/>
            <Var VarName="$AllEmpires">
                <From Source="$MajorEmpires"/>
            </Var>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01"  IntValue="3"/>
            <Var VarName="$One"       IntValue="1"/>
            <Var VarName="$PopAffinity" StringValue="AffinityMavros"/>
            <Var VarName="$PoliticalEffectMilitarist" StringValue="PopulationEventSophons04Military"/>
            <Var VarName="$Amount02" IntValue="1000"/>
            <Var VarName="$ResourceName" StringValue="SystemManpower"/>
            <Var VarName="$Descriptor01" StringValue="ManpowerStockIncreased"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
    
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectMilitarist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>                                
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>

                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_HasSystems>
                                            <Input_Empires VarName="$CurrentEmpire"/>
                                            <Input_MinimumAmount VarName="$One"/>
                                            <Input_Systems VarName="$ENFERSystem"/>
                                        </Condition_HasSystems>
                                    </Decorator_BeginTurn>
                                </Sequence>
                                <Sequence>
                                    <Decorator_InvadeSystem Initiator="Empire">
                                        <Input_System VarName="$ENFERSystem"/>                                        
                                    </Decorator_InvadeSystem>
                                </Sequence>
                            </Parallel>
                            
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>                           
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                        </Sequence>
                    </Objective>
                    
                    <Reward Droplist="DroplistRewardQuestSophons11" Picks="1"/> 
                    
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 4 - SCIENCE          -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter4-Science" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter4-Science,FactionFinalQuest,FactionQuestSophons</Tags>

        <QuestContextSolo/>

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$IAEmpire">
                <From Source="$LesserEmpire"/>
            </Var>
            <Var VarName="$ENFERSystem" IsGlobal="true"/>
            <Var VarName="$ENFERPlanet">
                <Any>
                    <From Source="$ENFERSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$ColonizedStarSystemGUID"/>
            <Var VarName="$ColonizedStarSystem"/>
            <Var VarName="$ColonizedPlanetGUID"/>
            <Var VarName="$ColonizedPlanet"/>
            <Var VarName="$SystemControllerName" StringValue="%ENFERName02"/>
            <Var VarName="$NewSystemName" StringValue="%ENFERSystemName02"/>
            <Var VarName="$AllEmpires">
                <From Source="$MajorEmpires"/>
            </Var>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01"  IntValue="3"/>
            <Var VarName="$PopAffinity" StringValue="AffinityMavros"/>           
            <InterpretedVar VarName="$ScienceAmount" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, EmpireResearch) *1.5</Expression>
            </InterpretedVar>
            <Var VarName="$PoliticalEffectScientist" StringValue="PopulationEventSophons04Scientist"/>
            <Var VarName="$ScienceTechnology" StringValue="CategoryTechnologyScienceAndExploration"/>
            <Var VarName="$DescriptorName01" StringValue="CannotBeInvaded"/>
            <Var VarName="$Amount02" IntValue="1000"/>
            <Var VarName="$ResourceName" StringValue="SystemManpower"/>
            <Var VarName="$Descriptor01" StringValue="ManpowerStockIncreased"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
            <Var VarName="$Descriptor03" StringValue="CannotBeInvaded"/>
            <LocalizationVar LocalizationKey="$ScienceAmountName" Source="$ScienceAmount"/>
            <Var VarName="$Amount03" IntValue="5"/>
            <LocalizationVar Source="$Amount03" LocalizationKey="$Amount03Name"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
  
        <!--============ STEPS ============-->

        <Steps>
            <Step Name="Step1">
             <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,AffinityGameplayVampirilis</PathPrerequisite>
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,AffinityGameplayUnfallen</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="1">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,AffinityGameplayVampirilis</PathPrerequisite>
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,AffinityGameplayUnfallen</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="2">
                        <Prerequisites Target="$(Empire)">
                            <InterpreterPrerequisite Flags="Prerequisite">Path(Context,@'ClassEmpire,EmpireTypeMajor,AffinityGameplayVampirilis') or Path(Context,@'ClassEmpire,EmpireTypeMajor,AffinityGameplayUnfallen')</InterpreterPrerequisite>                           
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="3">
                        <Prerequisites Target="$(Empire)">
                            <InterpreterPrerequisite Flags="Prerequisite">Path(Context,@'ClassEmpire,EmpireTypeMajor,AffinityGameplayVampirilis') or Path(Context,@'ClassEmpire,EmpireTypeMajor,AffinityGameplayUnfallen')</InterpreterPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                </Choice>
                <!--============ STEP 1 ============-->

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>   
                    </StartActions>
                    <Objective Name="Step1_Objective1">
                       <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>                           
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>                           
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>                           
                            <Sequence>                                
                                <Decorator_BeginTurn>
                                    <Condition_HasFidsi>
                                        <Input_Location VarName="$CurrentEmpire"/>
                                        <Input_Science VarName="$ScienceAmount"/>
                                    </Condition_HasFidsi>
                                </Decorator_BeginTurn>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor03"/>
                                    <Input_Targets VarName="$ColonizedStarSystem"/>
                                </Action_ApplyDescriptor>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor02"/>
                                    <Input_Targets VarName="$ColonizedPlanet"/>
                                </Action_ApplyDescriptor>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                        </Sequence>
                    </Objective>
                    
                    <Reward Droplist="DroplistRewardQuestSophons13" Picks="1"/>
                    <Reward LocalizationKey="%SophonsQuest-Chapter4-ScienceReward"/>
                    
                </ObjectiveSet>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>                       
                    </StartActions>
                    <Objective Name="Step2_Objective1" StartValue="0" EndValue="5">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>                            
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>                      
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>                                
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>                          
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>
                            <Loop Count="5">    
                                <Decorator_TechnologyUnlocked ProgressionIncrement="1">
                                    <Input_TechnologyCategory VarName="$ScienceTechnology"/>
                                </Decorator_TechnologyUnlocked>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Loop>
                           <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>                            
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_Colonize>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>                            
                            </Sequence>
                    </Objective>

                    <Reward Droplist="DroplistRewardQuestSophons12" Picks="1"/>
                    <Reward LocalizationKey="%SophonsQuest-Chapter4-ScienceReward"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step3_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_HasFidsi>
                                        <Input_Location VarName="$CurrentEmpire"/>
                                        <Input_Science VarName="$ScienceAmount"/>
                                    </Condition_HasFidsi>
                                </Decorator_BeginTurn>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor03"/>
                                    <Input_Targets VarName="$ColonizedStarSystem"/>
                                </Action_ApplyDescriptor>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor02"/>
                                    <Input_Targets VarName="$ColonizedPlanet"/>
                                </Action_ApplyDescriptor>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>                           
                        </Sequence>
                    </Objective>

                    <Reward Droplist="DroplistRewardQuestSophons13" Picks="1"/>                  

                </ObjectiveSet>

                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectScientist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step4_Objective1" StartValue="0" EndValue="5">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>
                            <Loop Count="5">
                                <Decorator_TechnologyUnlocked ProgressionIncrement="1">
                                    <Input_TechnologyCategory VarName="$ScienceTechnology"/>
                                </Decorator_TechnologyUnlocked>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Loop>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>                          
                        </Sequence>
                    </Objective>

                    <Reward Droplist="DroplistRewardQuestSophons12" Picks="1"/>                   
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 4 - DIPLOMACY         -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter4-Diplomacy" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false" AlternateVersion="SophonsQuest-Chapter4-DiplomacyBis">

        <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter4-Diplomacy,FactionFinalQuest,FactionQuestSophons</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$IAEmpire">
                <From Source="$LesserEmpire"/>
            </Var>
            <Var VarName="$ENFERSystem" IsGlobal="true"/>
            <Var VarName="$ENFERPlanet">
                <Any>
                    <From Source="$ENFERSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$ColonizedStarSystemGUID"/>
            <Var VarName="$ColonizedStarSystem"/>
            <Var VarName="$ColonizedPlanetGUID"/>
            <Var VarName="$ColonizedPlanet"/>
            <Var VarName="$SystemControllerName" StringValue="%ENFERName03"/>
            <Var VarName="$NewSystemName" StringValue="%ENFERSystemName03"/>
            <Var VarName="$AllEmpires">
                <From Source="$MajorEmpires"/>
            </Var>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01"  IntValue="3"/>
            <Var VarName="$PopAffinity" StringValue="AffinityMavros"/>
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons04Militarist"/>

            <Var VarName="$FleetSpawnTimer"  IntValue="3"/>
            <Var VarName="$FleetMissionDefinitionName01" StringValue="DefendSystem"/>
            <Var VarName="$FleetGUID"/>
            <Var VarName="$MissionGUID"/>
            <DroplistVar VarName="$FleetToSpawn01" Droplist="ENFERFleet01"/>
            
            <InterpretedVar VarName="$BloquadeTurnCount" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*16</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$Duration" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*6</Expression>
            </InterpretedVar>
            
            <Var VarName="$Amount02" IntValue="1000"/>
            <Var VarName="$ResourceName" StringValue="SystemManpower"/>
            <Var VarName="$Descriptor01" StringValue="ManpowerStockIncreased"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
            <Var VarName="$Descriptor03" StringValue="CannotBeInvaded"/>
            <LocalizationVar Source="$BloquadeTurnCount" LocalizationKey="$BloquadeTurnCountName"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,EmpireTypeMajor,AffinityGameplayVampirilis</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,EmpireTypeMajor,AffinityGameplayUnfallen</PathPrerequisite>
        </Prerequisites>
       
        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="0" EndValue="$BloquadeTurnCount">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>                                
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>                            
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>
                     
                              <Parallel CompletionPolicy="All">
                                <Loop>
                                    <Decorator_GuardNode ProgressionIncrement="1">
                                        <Input_Empire VarName="$CurrentEmpire"/>
                                        <Input_Node VarName="$ENFERSystem"/>                                   
                                    </Decorator_GuardNode>
                                  <Input_Count VarName="$BloquadeTurnCount"/>                                  
                                </Loop>
                                <Loop>
                                    <Action_SpawnFleets>
                                        <Input_Empire VarName="$IAEmpire"/>
                                        <Input_Locations VarName="$ENFERSystem"/>
                                        <Input_DroppableFleet VarName="$FleetToSpawn01"/>
                                        <Output_FleetGUIDs VarName="$FleetGUID"/>
                                    </Action_SpawnFleets>                                
                                    <Action_CreateFleetMissions>
                                        <Input_MissionDefinitionName VarName="$FleetMissionDefinitionName01"/>
                                        <Input_FleetGUIDs VarName="$FleetGUID"/>
                                        <Input_TargetEmpires VarName="$CurrentEmpire"/>
                                        <Output_MissionGUIDs VarName="$MissionGUID"/>
                                    </Action_CreateFleetMissions>
                                    <Decorator_Wait>
                                        <Input_WaitDuration VarName="$Duration"/>
                                    </Decorator_Wait>
                                    <Input_Count VarName="$FleetSpawnTimer"/>
                                </Loop>
                                </Parallel>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor02"/>
                                    <Input_Targets VarName="$ColonizedPlanet"/>
                                </Action_ApplyDescriptor>
                                <Action_ApplyDescriptor Remove="true">
                                    <Input_DescriptorName VarName="$Descriptor01"/>
                                    <Input_Targets VarName="$ColonizedStarSystem"/>
                                </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                                <Action_Colonize>
                                    <Input_Empire VarName="$CurrentEmpire"/>
                                    <Input_Planet VarName="$ENFERPlanet"/>
                                    <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                                </Action_Colonize>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>                             
                            </Sequence>              
                    </Objective>
                    
                   <Reward Droplist="DroplistRewardQuestSophons13" Picks="1"/>
                   <Reward LocalizationKey="%SophonsQuest-Chapter4-DiplomacyReward"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ####################################### -->
    <!--           Chapter 4 - DIPLOMACY         -->
    <!-- ####################################### -->

    <QuestDefinition Name="SophonsQuest-Chapter4-DiplomacyBis" Category="MajorQuest" SubCategory="Sophons" CheckRandom="false">

        <!--============ TAGS ============-->
        <Tags>SophonsQuest-Chapter4-Diplomacy,FactionFinalQuest,FactionQuestSophons</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$IAEmpire">
                <From Source="$LesserEmpire"/>
            </Var>
            <Var VarName="$ENFERSystem" IsGlobal="true"/>
            <Var VarName="$ENFERPlanet">
                <Any>
                    <From Source="$ENFERSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$ColonizedStarSystemGUID"/>
            <Var VarName="$ColonizedStarSystem"/>
            <Var VarName="$ColonizedPlanetGUID"/>
            <Var VarName="$ColonizedPlanet"/>
            <Var VarName="$SystemControllerName" StringValue="%ENFERName03"/>
            <Var VarName="$NewSystemName" StringValue="%ENFERSystemName03"/>
            <Var VarName="$AllEmpires">
                <From Source="$MajorEmpires"/>
            </Var>
            <Var VarName="$Marker01"/>
            <Var VarName="$Amount01"  IntValue="3"/>
            <Var VarName="$PopAffinity" StringValue="AffinityMavros"/>
            <Var VarName="$PoliticalEffectPacifist" StringValue="PopulationEventSophons04Militarist"/>

            <Var VarName="$FleetSpawnTimer"  IntValue="3"/>
            <Var VarName="$FleetMissionDefinitionName01" StringValue="DefendSystem"/>
            <Var VarName="$FleetGUID"/>
            <Var VarName="$MissionGUID"/>
            <DroplistVar VarName="$FleetToSpawn01" Droplist="ENFERFleet01"/>

            <InterpretedVar VarName="$BloquadeTurnCount" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*16</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$Duration" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*6</Expression>
            </InterpretedVar>

            <Var VarName="$Amount02" IntValue="1000"/>
            <Var VarName="$ResourceName" StringValue="SystemManpower"/>
            <Var VarName="$Descriptor01" StringValue="ManpowerStockIncreased"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
            <Var VarName="$Descriptor03" StringValue="CannotBeInvaded"/>
            <LocalizationVar Source="$BloquadeTurnCount" LocalizationKey="$BloquadeTurnCountName"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

      

        <!--============ STEPS ============-->

        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectPacifist"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="0" EndValue="$BloquadeTurnCount">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_Planet VarName="$ENFERPlanet"/>
                                <Output_ColonizedStarSystemGUID VarName="$ColonizedStarSystemGUID"/>
                                <Output_ColonizedPlanetGUID VarName="$ColonizedPlanetGUID"/>
                            </Action_Colonize>
                            <Parallel CompletionPolicy="All">
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedStarSystemGUID"/>
                                    <Output_Entity VarName="$ColonizedStarSystem"/>
                                </Decorator_EntityCreated>
                                <Decorator_EntityCreated>
                                    <Input_GUID VarName="$ColonizedPlanetGUID"/>
                                    <Output_Entity VarName="$ColonizedPlanet"/>
                                </Decorator_EntityCreated>
                            </Parallel>
                            <Action_RegisterLesserName>
                                <Input_GUIDs VarName="$ColonizedStarSystemGUID"/>
                                <Input_Name VarName="$SystemControllerName"/>
                            </Action_RegisterLesserName>
                            <Action_RenameSystem>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Name VarName="$NewSystemName"/>
                            </Action_RenameSystem>
                            <Action_SetInvisibility Invisible="false">
                                <Input_Empires VarName="$AllEmpires"/>
                                <Input_TargetEntities VarName="$ENFERSystem"/>
                            </Action_SetInvisibility>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$IAEmpire"/>
                                <Input_System VarName="$ENFERSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor>
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_TransferResource>
                                <Input_Location VarName="$ColonizedStarSystem"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_AddQuestMarkers RevealsLocation="true">
                                <Input_Targets VarName="$ENFERSystem"/>
                                <Input_Empires VarName="$CurrentEmpire"/>
                                <Output_Markers VarName="$Marker01"/>
                            </Action_AddQuestMarkers>

                            <Parallel CompletionPolicy="All">
                                <Loop>
                                    <Decorator_GuardNode ProgressionIncrement="1">
                                        <Input_Empire VarName="$CurrentEmpire"/>
                                        <Input_Node VarName="$ENFERSystem"/>
                                    </Decorator_GuardNode>
                                    <Input_Count VarName="$BloquadeTurnCount"/>
                                </Loop>
                                <Loop>
                                    <Action_SpawnFleets>
                                        <Input_Empire VarName="$IAEmpire"/>
                                        <Input_Locations VarName="$ENFERSystem"/>
                                        <Input_DroppableFleet VarName="$FleetToSpawn01"/>
                                        <Output_FleetGUIDs VarName="$FleetGUID"/>
                                    </Action_SpawnFleets>
                                    <Action_CreateFleetMissions>
                                        <Input_MissionDefinitionName VarName="$FleetMissionDefinitionName01"/>
                                        <Input_FleetGUIDs VarName="$FleetGUID"/>
                                        <Input_TargetEmpires VarName="$CurrentEmpire"/>
                                        <Output_MissionGUIDs VarName="$MissionGUID"/>
                                    </Action_CreateFleetMissions>
                                    <Decorator_Wait>
                                        <Input_WaitDuration VarName="$Duration"/>
                                    </Decorator_Wait>
                                    <Input_Count VarName="$FleetSpawnTimer"/>
                                </Loop>
                            </Parallel>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor02"/>
                                <Input_Targets VarName="$ColonizedPlanet"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor01"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>
                            <Action_ApplyDescriptor Remove="true">
                                <Input_DescriptorName VarName="$Descriptor03"/>
                                <Input_Targets VarName="$ColonizedStarSystem"/>
                            </Action_ApplyDescriptor>                           
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                        </Sequence>
                    </Objective>

                    <Reward Droplist="DroplistRewardQuestSophons13" Picks="1"/>                    
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>


</Datatable>